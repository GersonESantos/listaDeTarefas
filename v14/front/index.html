<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Tarefas</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fontawesome/all.min.css">
    <link rel="shortcut icon" href="assets/imagens/favicon.png" type="image/png">
</head>
<body>
    // javascript do index.html

    let id = 1
    
    window.onload = () => {
        
        get_username(id);
        get_user_tasks(id);
    }
    
    // ---------------------------------------------------
    function get_username(id){
    
        fetch(`http://localhost:3000/user/${id}`)
        .then(response => {
            if(response.status === 200){
                return response.json();
            } else {
                console.log('ERRO!');
            }
        })
        .then(dados => {
            if(dados.length === 0){
                console.log('Erro!');
            } else {
                document.querySelector("#username").textContent = dados[0].username;
            }
        })
    
    }
    
    // ---------------------------------------------------
    function get_user_tasks(id){
    
        fetch(`http://localhost:3000/user/${id}/tasks`)
        .then(response => {
            if(response.status === 200){
                return response.json();
            } else {
                console.log('ERRO!');
            }
        })
        .then(tarefas => {
            if(tarefas.length === 0){
                document.querySelector("#no_tasks").classList.remove("d-none");
                document.querySelector("#total_tasks").classList.add("d-none");
            } else {
                
                document.querySelector("#tasks_container").innerHTML = null;
    
                let colors = [
                    {
                        task_status: 'new',
                        select_bg_color: 'bg-white'
    
                    },
                    {
                        task_status: 'in progress',
                        select_bg_color: 'bg-info'
    
                    },
                    {
                        task_status: 'canceled',
                        select_bg_color: 'bg-danger'
    
                    },
                    {
                        task_status: 'done',
                        select_bg_color: 'bg-success'
    
                    },
                ];
    
                tarefas.forEach(tarefa => {
    
                    let color = colors.find(item => item.task_status == tarefa.task_status);
    
                    let html = `
                    <div class="col-12 border border-secondary rounded p-3 shadow">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <div class="d-flex align-items-center">
                                    <h5 class="me-3 text-info"><i class="fa-solid fa-circle-chevron-right"></i></h5>
                                    <h5>${tarefa.task_text}</h5>
                                </div>
                            </div>
                            <div class="col-2">
                                <select id="task_status" class="form-select p-2 ${color.select_bg_color}">
                                    <option value="new" ${tarefa.task_status == 'new' ? 'selected' : ''}>New</option>
                                    <option value="in progress" ${tarefa.task_status == 'in progress' ? 'selected' : ''}>In progress</option>
                                    <option value="canceled" ${tarefa.task_status == 'canceled' ? 'selected' : ''}>Canceled</option>
                                    <option value="done" ${tarefa.task_status == 'done' ? 'selected' : ''}>Done</option>
                                </select>
                            </div>
                            <div class="col-1 text-end"><span class="edit_link" data-id-task="${tarefa.id}"><i class="fa-regular fa-pen-to-square me-2"></i>Edit</span></div>
                            <div class="col-1 text-end"><span class="delete_link" data-id-task="${tarefa.id}"><i class="fa-regular fa-trash-can me-2"></i>Delete</span></div>
                        </div>
                    </div>`;
    
                    let new_task = document.createElement('div');
                    new_task.classList.add('row', 'mb-3');
                    new_task.innerHTML = html;
    
                    document.querySelector("#tasks_container").appendChild(new_task);
                });
    
                document.querySelector("#no_tasks").classList.add("d-none");
                document.querySelector("#total_tasks").classList.remove("d-none");
                document.querySelector("#total_tasks > div > h4 > span").textContent = tarefas.length;
            }
        })
    }
    <div class="container my-5">   

        <!-- cabeçalho -->
        <div class="row mb-4">
            <div class="col">
                <div class="d-flex justify-content-start">
                    <img src="assets/imagens/favicon.png" alt="Logo" class="img-fluid me-3" width="40px">
                    <h1>Lista de Tarefas</h1>
                </div>
            </div>
            <div class="col text-end">
                <div class="d-flex justify-content-end">
                    <select id="select_filter" class="form-select w-50 p-2 me-3">
                        <option value="0">Todas</option>
                        <option value="1">Pendentes</option>
                        <option value="2">Concluídas</option>
                    </select>
                    <a href="new_task.html" class="btn btn-primary"><i class="fa-solid fa-plus me-2"></i>Nova tarefa</a>                
            </div>
        </div>   
        <hr class="mt-3">
        <h4 class="m-0 p-0"><i class="fa-solid fa-user-tie me-2"></i><span id="username"></span></h4>
        <hr class="mt-3">
    </div>
    
        <!-- nova tarefa -->
        <div class="row mb-3">
            <div class="col-12 border border-secondary rounded p-3 shadow">
                <div class="row aling-items-center">
                    <div class="col-8">
                        <div class="d-flex aling-items-center">

                            <h5 class="me-3 text-info"><i class="fa-solid fa-circle-chevron-right"></i></h5>
                            <h7><i class="fa-solid fa-list-check"></i>Lorem ipsum dolor sit amet consectetur
                                adipisicing elit. Culpa eaque fugiat, possimus
                                corporis debitis fugit.
                            </h7>

                        </div>
                    </div>
                    <div class="col-2">
                        <select id="task_status" class="form-select p-2">
                            <option value="new">new</option>
                            <option value="in progress">in progress</option>
                            <option value="Cancelad">Cancelad</option>
                            <option value="Done">Done</option>
                        </select>
                    </div>
                    <div class="col-1 text-info text-end "><i class="fa-regular fa-pen-to-square me-2"></i>Edit</div>
                    <div class="col-1 text-danger text-end"><i class="fa-regular fa-trash-can me-2"></i>Delete</div>
                </div>

            </div>
        </div>
        <!-- total de tarefas -->
        <div class="row" id="total_tasks">
            <div class="col text"></div>
            <h4>Tarefas: <span class="text-info font-weight-bold">4</span></h4>
        </div>

        <!-- sem tarefas -->
        <div class="row mb-3" id="no_tasks.html">
            <div class="col text-center">
                <span class="opcity-75">Não existe tarefas</span>
            </div>

            <!-- foot -->
            <div class="row mt-3">
                <div class="col text-center">
                    <p>Lista de tarefas &copy: 2025</p>
                    <span class="opcity-75"></span>
                </div>
            </div>

            <script src="assets/js/bootstrap.bundle.min.js"></script>
            <script src="assets/js/index.js"></script>
        </div>
</body>

</html>